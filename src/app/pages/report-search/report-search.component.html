<div class="report-search-top">
  <div class="report-search-header">
    <h1 class="report-search-header-text">
      {{ 'reportSearch.header' | translate }}
    </h1>
    <crh-button
      *ngIf="isLoggedIn()"
      class="report-search-header-latest"
      (click)="onLatestClick()">
      {{ 'reportSearch.latest' | translate }}
    </crh-button>
  </div>

  <form class="report-search-control" [formGroup]="searchFormGroup">
    <div class="report-search-control-filters">
      <!-- TEXT INPUT: REPORT NUMBER -->
      <div class="filter-wrapper">
        <div class="floating-label">
          <input
            type="text"
            formControlName="reportNo"
            placeholder=" "
            class="search-box" />
          <label>Report No</label>
        </div>
      </div>

      <!-- DROPDOWN FOR TYPE SELECTION -->
      <div class="filter-wrapper">
        <div class="floating-label">
          <mat-form-field class="dropdown-form-field" appearance="outline">
            <mat-label>Type</mat-label>
            <mat-select formControlName="type">
              <mat-option [value]="'daily'">Daily</mat-option>
              <mat-option [value]="'weekly'">Weekly</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <!-- ANGULAR MATERIAL DATE PICKER: FROM DATE -->
      <div class="filter-wrapper">
        <mat-form-field class="date-picker-form-field" appearance="outline">
          <mat-label>{{
            'reportSearch.search.fromLabel' | translate
          }}</mat-label>
          <input
            matInput
            [formControlName]="'startDate'"
            [matDatepicker]="pickerFrom"
            placeholder=" " />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerFrom"></mat-datepicker-toggle>
          <mat-datepicker #pickerFrom></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- ANGULAR MATERIAL DATE PICKER: TO DATE -->
      <div class="filter-wrapper">
        <mat-form-field class="date-picker-form-field" appearance="outline">
          <mat-label>{{ 'reportSearch.search.toLabel' | translate }}</mat-label>
          <input
            matInput
            [formControlName]="'endDate'"
            [matDatepicker]="pickerTo"
            placeholder=" " />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerTo"></mat-datepicker-toggle>
          <mat-datepicker #pickerTo></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- SEARCH BUTTON -->
      <div class="filter-wrapper">
        <button class="search-button" (click)="onSearch()">Search</button>
      </div>
    </div>

    <div class="report-search-control-pages">
      <crh-paginator
        [options]="[10, 20, 50]"
        [totalResults]="reportSearchTotalSignal()"
        (pageStatus)="paginatorStatusSignal.set($event)">
      </crh-paginator>
    </div>
  </form>
</div>

<div>
  <hr class="report-search-divider" />
</div>

<!-- REPORT TABLE -->
<div class="report-search-content">
  <table class="report-table">
    <thead>
      <tr>
        <th>No</th>
        <th>Type</th>
        <th>Generated Date</th>
        <th>Last Modified</th>
        <th *ngIf="isLoggedIn()">Email Sent</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Show "No Data" message when no reports exist -->
      <tr *ngIf="filteredReportsSignal()?.length === 0">
        <td colspan="5" class="no-data">No reports available</td>
      </tr>

      <!-- Loop through filtered reports -->
      <tr *ngFor="let report of filteredReportsSignal()">
        <td>{{ report.reportId }}</td>
        <td>
          {{ report.type === 'daily' ? 'Daily' : 'Weekly' }}
        </td>
        <td>{{ report.generatedDate | date: 'medium' }}</td>
        <td>{{ report.lastModified | date: 'medium' }}</td>
        <td *ngIf="isLoggedIn()">{{ report.emailStatus ? '✔' : '✘' }}</td>
        <td class="actions-column">
          <button class="view-button" (click)="onViewReport(report)">
            View
          </button>
          <button
            *ngIf="isLoggedIn()"
            class="delete-button"
            (click)="onDeleteReport(report)">
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
