<div class="report-search-top">
  <div class="report-search-header">
    <h1 class="report-search-header-text">
      {{ 'reportSearch.header' | translate }}
    </h1>
    <crh-button
      *ngIf="isLoggedIn()"
      class="report-search-header-latest"
      (click)="onLatestClick()">
      {{ 'reportSearch.latest' | translate }}
    </crh-button>
  </div>

  <form class="report-search-control" [formGroup]="searchFormGroup">
    <div class="report-search-control-filters">
      <!-- TEXT INPUT: REPORT NUMBER -->
      <div class="filter-wrapper">
        <div class="floating-label">
          <input
            type="text"
            formControlName="reportNo"
            placeholder=" "
            class="search-box" />
          <label>Report No</label>
        </div>
      </div>

      <!-- DROPDOWN FOR TYPE SELECTION -->
      <div class="filter-wrapper">
        <mat-form-field class="dropdown-form-field" appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select formControlName="type">
            <mat-option value="DAILY">Daily</mat-option>
            <mat-option value="WEEKLY">Weekly</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- FROM DATE PICKER -->
      <div class="filter-wrapper">
        <mat-form-field class="date-picker-form-field" appearance="outline">
          <mat-label>{{
            'reportSearch.search.fromLabel' | translate
          }}</mat-label>
          <input
            matInput
            [formControl]="searchFormGroup.controls.startDate"
            [matDatepicker]="pickerFrom"
            placeholder=" "
            [value]="
              searchFormGroup.controls.startDate.value
                ? (searchFormGroup.controls.startDate.value.toISODate()
                  | date: 'yyyy-MM-dd')
                : ''
            "
            (dateChange)="
              searchFormGroup.controls.startDate.setValue(
                $event.value ? DateTime.fromJSDate($event.value) : null
              )
            " />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerFrom"></mat-datepicker-toggle>
          <mat-datepicker #pickerFrom></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- TO DATE PICKER -->
      <div class="filter-wrapper">
        <mat-form-field class="date-picker-form-field" appearance="outline">
          <mat-label>{{ 'reportSearch.search.toLabel' | translate }}</mat-label>
          <input
            matInput
            [formControl]="searchFormGroup.controls.endDate"
            [matDatepicker]="pickerTo"
            placeholder=" "
            [value]="
              searchFormGroup.controls.endDate.value
                ? (searchFormGroup.controls.endDate.value.toISODate()
                  | date: 'yyyy-MM-dd')
                : ''
            "
            (dateChange)="
              searchFormGroup.controls.endDate.setValue(
                $event.value ? DateTime.fromJSDate($event.value) : null
              )
            " />
          <mat-datepicker-toggle
            matSuffix
            [for]="pickerTo"></mat-datepicker-toggle>
          <mat-datepicker #pickerTo></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- SEARCH BUTTON -->
      <div class="filter-wrapper">
        <button class="search-button" (click)="onSearch()">Search</button>
      </div>
    </div>
  </form>
</div>

<div class="report-search-content">
  <table class="report-table">
    <thead>
      <tr>
        <th>No</th>
        <th>Type</th>
        <th>Generated Date</th>
        <th>Last Modified</th>
        <th *ngIf="isLoggedIn()">Email Sent</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Show "No Data" message when no reports exist -->
      <tr *ngIf="filteredReportsSignal()?.length === 0">
        <td colspan="5" class="no-data">No reports available</td>
      </tr>

      <!-- Loop through filtered reports -->
      <tr *ngFor="let report of filteredReportsSignal()">
        <td>{{ report?.reportId }}</td>
        <td>{{ report?.type === 'DAILY' ? 'Daily' : 'Weekly' }}</td>
        <td>{{ report?.generatedDate | date: 'medium' }}</td>
        <td>{{ report?.lastModified | date: 'medium' }}</td>
        <td *ngIf="isLoggedIn()">{{ report?.emailStatus ? '✔' : '✘' }}</td>
        <td class="actions-column">
          <button class="view-button" (click)="onViewReport(report)">
            View
          </button>
          <button
            *ngIf="isLoggedIn()"
            class="delete-button"
            (click)="onDeleteReport(report)">
            Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
