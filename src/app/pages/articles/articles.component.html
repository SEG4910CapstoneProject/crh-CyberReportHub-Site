<div class="articles-page-container">
  <div class="header">
    <h1>Articles</h1>
    <!-- "Add Article" button in the top right -->
    <button class="add-article-btn" routerLink="/articles/add">
      Add Article
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading articles...</p>
  </div>

  <!-- Articles Section -->
  <div *ngIf="!isLoading" class="sections">
    <!-- Loop through the categories -->
    <div *ngFor="let category of categories" class="category-section">
      <h2>{{ category }}</h2>
      <div *ngIf="articlesByCategory[category]?.length; else emptySection">
        <ul>
          <li
            *ngFor="
              let article of articlesByCategory[category]?.slice(
                0,
                articlesToShow[category]
              )
            ">
            <a [href]="article.link" target="_blank">{{ article.title }}</a>
            <p>{{ article.description }}</p>
            <p><strong>Published:</strong> {{ article.publishDate }}</p>

            <!-- Only show the star icon for logged-in users -->
            <span
              class="star-icon"
              *ngIf="isLoggedIn()"
              (click)="toggleFavourite(article)"
              [class.fav]="isFavourite(article)">
              &#9733;
            </span>

            <!-- Only show the checkbox for "Article of Note" for logged-in users -->
            <label *ngIf="isLoggedIn()">
              <input
                type="checkbox"
                (change)="toggleArticleOfNote(article, $event)"
                [checked]="isArticleOfNote(article)">
              Article of Note
            </label>

          </li>
        </ul>

        <!-- Show 'See More' or 'See Less' button depending on whether the full list is visible -->
        <button
          *ngIf="articlesToShow[category] === 5"
          (click)="toggleArticles(category)">
          See More
        </button>
        <button
          *ngIf="articlesToShow[category] !== 5"
          (click)="toggleArticles(category)">
          See Less
        </button>
      </div>
      <ng-template #emptySection>
        <p>No articles yet.</p>
      </ng-template>
    </div>
  </div>

  <!-- Show the Favourites section if the user is logged in -->
  <div *ngIf="isLoggedIn()">
    <h2>Your Favourites</h2>
    <div *ngIf="favouriteArticles.length; else noFavourites">
      <ul>
        <li *ngFor="let fav of favouriteArticles">
          <a [href]="fav.link" target="_blank">{{ fav.title }}</a>
        </li>
      </ul>
    </div>
    <ng-template #noFavourites>
      <p>No favourites yet.</p>
    </ng-template>
  </div>

  <!-- Show the "Articles of Note" section for all users -->
  <div>
    <h2>Your Articles of Note</h2>
    <ul>
      <li *ngFor="let article of articlesOfNote">
        <a [href]="article.link" target="_blank">{{ article.title }}</a>
      </li>
    </ul>
  </div>

</div>
